extends ../layout


block content
	h1
		Events
	.container
		#km-calendar.responsive-calendar
			.controls
				a.pull-left(data-go='prev')
					.btn.btn-primary Prev
				h4
					span(data-header-year)
					span(data-head-month)
				a.pull-right(data-go='next')
					.btn.btn-primary Next
			hr
			.day-headers
				.day.header Sunday
				.day.header Monday
				.day.header Tuesday
				.day.header Wednesday
				.day.header Thursday
				.day.header Friday
				.day.header Saturday
			.days(data-group='days')
	#editDay.modal.fade
		.modal-dialog.modal-lg
			.modal-content
				.modal-header
					button.close(data-dismiss="modal",aria-label="Close")
						span(aria-hidden="true") &times;
					h4.modal-title Events
				.modal-body
					#eventsViewer.eventsViewer
				.modal-footer
					button.btn.btn-primary.addEvent#addEvent + Add Event
					button.btn.btn-default(data-dismiss="modal") Close
	script(src='/javascripts/responsive-calendar.js')
	script(src='/javascripts/admin/events.js')
	script(id='EditEventTemplate',type='text/x-handlebars-template').
		<div class="single_event">
			<div class="single_event_edit" data-eventId="{{_id}}">
				<div class="first-row">
					<div class="editable event_title" data-eventField="title" >
						English Title: {{title}}
					</div>
					<div class="editable event_title_kr" data-eventField="title" >
						Korean Title (직함): {{title_kr}}
					</div>
					<div class="event_time">
						<p>{{fromTime.hour}}:{{fromTime.minute}} {{fromTime.period}} - {{toTime.hour}}:{{toTime.minute}} {{toTime.period}}</p>
					</div>
				</div>
				<div class="editable_area event_description" data-eventField="description">
					English Description: {{description}}
				</div>
				<div class="editable_area event_description" data-eventField="description">
					Korean Description (서술): {{description_kr}}
				</div>
			</div>
			<button class="delete_event btn btn-primary" data-eventId="{{_id}}">Delete</button>
		</div>
	script(id='SingleEventTemplate',type='text/x-handlebars-template').
		<div class="single_event_edit" data-eventId="{{_id}}">
			<div class="first-row">
				<div class="editable event_title" data-eventField="title" >
					<label for="event_title_input">English Title:</label>
					<input type="text" class="form-control" id="event_title_input" value="{{title}}"/>
				</div>
				<div class="editable event_title_kr" data-eventField="title_kr" >
					<label for="event_title_kr_input">Korean Title (직함):</label>
					<input type="text" class="form-control" id="event_title_kr_input" lang="kr" value="{{title_kr}}"/>
				</div>
				<div class="event_time">
					<label>Time Period:</label>
					<div class="event_input">
						<div class="select_event_container">
							<select class="event_time_input" id="event_fromTimeHour_input" data-value="{{fromTime.hour}}">
							  <option>1</option>
							  <option>2</option>
							  <option>3</option>
							  <option>4</option>
							  <option>5</option>
							  <option>6</option>
							  <option>7</option>
							  <option>8</option>
							  <option>9</option>
							  <option>10</option>
							  <option>11</option>
							  <option>12</option>
							</select>
						</div>
						<div class="select_event_container">
							<p>:</p>
						</div>
						<div class="select_event_container">
							<select class="event_time_input" id="event_fromTimeMinute_input" data-value="{{fromTime.minute}}">
							  <option>00</option>
							  <option>15</option>
							  <option>30</option>
							  <option>45</option>
							</select>
						</div>
						<div class="select_event_container">
							<p> </p>
						</div>
						<div class="select_event_container">
							<select class="event_time_input" id="event_fromTimePeriod_input" data-value="{{fromTime.period}}">
							  <option>AM</option>
							  <option>PM</option>
							</select>
						</div>
						<div class="select_event_container">
							<p> - </p>
						</div>
						<div class="select_event_container">
							<select class="event_time_input" id="event_toTimeHour_input" data-value="{{toTime.hour}}">
							  <option>1</option>
							  <option>2</option>
							  <option>3</option>
							  <option>4</option>
							  <option>5</option>
							  <option>6</option>
							  <option>7</option>
							  <option>8</option>
							  <option>9</option>
							  <option>10</option>
							  <option>11</option>
							  <option>12</option>
							</select>
						</div>
						<div class="select_event_container">
							<p>:</p>
						</div>
						<div class="select_event_container">
							<select class="event_time_input" id="event_toTimeMinute_input" data-value="{{toTime.minute}}">
							  <option>00</option>
							  <option>15</option>
							  <option>30</option>
							  <option>45</option>
							</select>
						</div>
						<div class="select_event_container">
							<p> </p>
						</div>
						<div class="select_event_container">
							<select class="event_time_input" id="event_toTimePeriod_input" data-value="{{toTime.period}}">
							  <option>AM</option>
							  <option>PM</option>
							</select>
						</div>
					</div>
				</div>
			</div>
			<div class="editable_area event_description second-row" data-eventField="description">
				<label for="event_description_input">English Description:</label>
				<textarea class="form-control" id="event_description_input">{{description}}</textarea>
			</div>
			<div class="editable_area event_description third-row" data-eventField="description_kr">
				<label for="event_description_kr_input">Korean Description (서술):</label>
				<textarea class="form-control" id="event_description_kr_input">{{description_kr}}</textarea>
			</div>
			<button class="btn btn-primary event_update" type="submit">Update</button>
			<button class="btn btn-default event_cancel" type="cancel">Cancel</button>
		</div>
		
	script.
		$(document).ready(function () {
			var EventsEditor = new EventEditor();
			
			$("#addEvent").on('click', function(){
				EventsEditor.newEvent();
			});
			
			$("#editDay").on('click', '.delete_event', function(){
				var eventId = $(this).data('eventid');
				EventsEditor.deleteEvent(eventId);
			});
			
			$('#editDay').on('show.bs.modal', function (event) {
				var dayElement = $(event.relatedTarget) // Button that triggered the modal
				var getDate = dayElement.data('year') + "-" + dayElement.data('month') + "-" + dayElement.data('day');
				var editModal = $(this);
				EventsEditor.initModal(getDate, dayElement.data('month'));
			});
		
			$("#km-calendar").responsiveCalendar({
				admin: true,
				onDayClick: function(events){
					$("#editDay").modal();
				},
				onDrawChange: function(events){
					$("#km-calendar").responsiveCalendar('getMonthYear', function(currYear, currMonth){
						$.get('/events/getMonthEvents',{month: currMonth, year: currYear},function(monthEvents){
							$("#km-calendar").responsiveCalendar('clearAll');
							$("#km-calendar").responsiveCalendar('edit', monthEvents);
						});
					});
				},
				activateNonCurrentMonths: false
			});
			
			EventsEditor.updateCalendar();
		});

